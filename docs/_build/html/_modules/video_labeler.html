<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>video_labeler &mdash; Video Labeler 16.03.2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/my_theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=fd32293a"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >

          
          
          <a href="../index.html" class="icon icon-home">
            Video Labeler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../video_labeler.html">Video Labeler</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Video Labeler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">video_labeler</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for video_labeler</h1><div class="highlight"><pre>
<span></span><span class="c1"># For handling different OS</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">locale</span>

<span class="c1"># For different file-formats</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="c1"># For plotting Hotkeys</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># App Widgets</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QTableWidget</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QGridLayout</span><span class="p">,</span> <span class="n">QScrollArea</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QStyle</span><span class="p">,</span> \
    <span class="n">QShortcut</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QSplitter</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QAbstractItemView</span><span class="p">,</span> <span class="n">QMessageBox</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QTimer</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QKeySequence</span><span class="p">,</span> <span class="n">QCloseEvent</span>

<span class="c1"># MPV Player and Style of the App</span>
<span class="kn">import</span> <span class="nn">mpv</span>
<span class="kn">from</span> <span class="nn">qt_material</span> <span class="kn">import</span> <span class="n">apply_stylesheet</span>

<span class="c1"># For Documentation</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">List</span>


<div class="viewcode-block" id="Labeler">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Labeler">[docs]</a>
<span class="k">class</span> <span class="nc">Labeler</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the &quot;main&quot; class for the application. It brings everything together. Also loading</span>
<span class="sd">    classes:</span>

<span class="sd">    - MouseEventHandler() as mouse_event</span>
<span class="sd">    - Layout() as layout</span>
<span class="sd">    - AppFunctions() as app_functions</span>
<span class="sd">    - Logger() as logger</span>
<span class="sd">    - ActivityHandler() as activity_handler</span>

<span class="sd">    Everything is set up here. Also loading the .json files and processing and binding them.a</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Labeler.__init__">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Labeler.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event</span> <span class="o">=</span> <span class="n">MouseEventHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Get access to MouseEventHandler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Get access to Layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_functions</span> <span class="o">=</span> <span class="n">AppFunctions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Get access to Settings methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Get access to Logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activity_handler</span> <span class="o">=</span> <span class="n">ActivityHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Get access to ActivityHandler</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Video Labeler&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">application</span>

        <span class="c1"># Cached values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_window_activity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_table_changed</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Needed for saving data, if some changes happened</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">playtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">playtime</span>  <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_name_playing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">now_playing</span>  <span class="c1"># Showing name of Video</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">app_window_layout</span>  <span class="c1"># Main Window</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">video</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">player</span>

        <span class="c1"># Define Playlist (left side list, to play videos from)</span>
        <span class="c1"># If click on a row, it will play the video</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">video_table</span>
        <span class="c1"># noinspection PyUnresolvedReferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">video_table_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_functions</span><span class="o">.</span><span class="n">update_video_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_table_scroll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">video_table_scroll</span>

        <span class="c1"># Define DataTable, for entered observations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">data_table</span>
        <span class="c1"># Scroll Area for data Table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_table_scroll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">data_table_scroll</span>
        <span class="c1"># noinspection PyUnresolvedReferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">data_table_click</span><span class="p">)</span>

        <span class="c1"># Define Time Slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">time_slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">mousePressEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">slider_move</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">mouseMoveEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">slider_move</span>

        <span class="c1"># Define Logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">logger_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_scroller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">logger_scroll</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">logger_grid</span>

        <span class="c1"># Vertical (v) und Horizontal (h) splitter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">splitter_v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">splitter_h</span>
        <span class="c1"># noinspection PyUnresolvedReferences</span>

        <span class="c1"># Resizing tables, if clicking on the splitter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_h</span><span class="o">.</span><span class="n">splitterMoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">splitter_click</span><span class="p">)</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">splitter_click</span><span class="p">)</span>

        <span class="c1"># Loading shortcuts, commands for the mpv player and the settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closeEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">close_app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_shortcuts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands_mpv</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span></div>


<div class="viewcode-block" id="Labeler.commands_mpv">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Labeler.commands_mpv">[docs]</a>
    <span class="k">def</span> <span class="nf">commands_mpv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All the commands defined in commands_mpv.json will be loaded and set for the mpv-player.</span>

<span class="sd">        For more information, see:</span>
<span class="sd">        https://github.com/mpv-player/mpv/blob/master/etc/input.conf</span>
<span class="sd">        https://mpv.io/manual/stable/#command-interface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;commands_mpv.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">shortcuts</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">shortcut</span><span class="p">,</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">shortcut</span> <span class="o">=</span> <span class="n">QShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="n">shortcut</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
            <span class="c1"># noinspection PyUnresolvedReferences</span>
            <span class="n">shortcut</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">commands</span><span class="o">=</span><span class="n">command</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_commands_mpv</span><span class="p">(</span><span class="n">commands</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">_handle_commands_mpv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">:</span> <span class="nb">str</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the commands defined in commands_mpv and set this to the mpv-player</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">commands</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span>

<div class="viewcode-block" id="Labeler.settings">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Labeler.settings">[docs]</a>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will load the settings.json file and process the settings, that are set up.</span>
<span class="sd">        Like the size of the window, or some other hotkeys etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;settings.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;()&quot;</span><span class="p">:</span>
                <span class="n">shortcut</span> <span class="o">=</span> <span class="n">QShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
                <span class="c1"># noinspection PyUnresolvedReferences</span>
                <span class="n">shortcut</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_functions</span><span class="p">,</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;style&quot;</span><span class="p">:</span>
                <span class="c1"># https://pypi.org/project/qt-material/</span>
                <span class="n">apply_stylesheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;density_scale&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;width_height&quot;</span><span class="p">:</span>
                <span class="n">w_h</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">w_h</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">w_h</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;log_max&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span></div>


<div class="viewcode-block" id="Labeler.label_shortcuts">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Labeler.label_shortcuts">[docs]</a>
    <span class="k">def</span> <span class="nf">label_shortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will load the label_shortcuts.json file and process the shortcuts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;label_shortcuts.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">shortcuts</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">act_type</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">shortcut_key</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="p">[</span><span class="n">act_type</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">shortcut</span> <span class="o">=</span> <span class="n">QShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="n">shortcut_key</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
                <span class="c1"># noinspection PyUnresolvedReferences</span>
                <span class="n">shortcut</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">labels</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">act_types</span><span class="o">=</span><span class="n">act_type</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="o">=</span><span class="n">shortcut_key</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_label_shortcuts</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">act_types</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">_handle_label_shortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">act_types</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is handling the shortcuts for the labels. In this case there are only two options,</span>
<span class="sd">        time_window and point_activity to handle. Where The time_window needs to be pressed</span>
<span class="sd">        twice to write two values within the table. The point_activity needs only once to be pressed</span>
<span class="sd">        to track StartTime and EndTime.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">video_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_name_playing</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">play_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">playtime</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># &quot;StartTime&quot;, &quot;EndTime&quot;, &quot;ActType&quot;, &quot;Label&quot;, &quot;Video&quot;</span>
        <span class="n">data_to_insert</span> <span class="o">=</span> <span class="p">[</span><span class="n">play_time</span><span class="p">,</span> <span class="n">play_time</span><span class="p">,</span> <span class="n">act_types</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">video_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">act_types</span> <span class="o">==</span> <span class="s2">&quot;time_window&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activity_handler</span><span class="o">.</span><span class="n">populate_data_table_time_window</span><span class="p">(</span><span class="n">data_to_insert</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">act_types</span> <span class="o">==</span> <span class="s2">&quot;point_activity&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activity_handler</span><span class="o">.</span><span class="n">populate_data_table_point_activity</span><span class="p">(</span><span class="n">data_to_insert</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_slider_time_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the position of the slider, defined by current video time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">duration</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">isSliderDown</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

<div class="viewcode-block" id="Labeler.observe_time_position">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Labeler.observe_time_position">[docs]</a>
    <span class="k">def</span> <span class="nf">observe_time_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Observing the time position and writing it into the playtime widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">property_observer</span><span class="p">(</span><span class="s1">&#39;time-pos&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">time_observer</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">playtime</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_slider_time_change</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">playtime</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ActivityHandler">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.ActivityHandler">[docs]</a>
<span class="k">class</span> <span class="nc">ActivityHandler</span><span class="p">:</span>
<div class="viewcode-block" id="ActivityHandler.__init__">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.ActivityHandler.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labeler_instance</span><span class="p">:</span> <span class="n">Labeler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span> <span class="o">=</span> <span class="n">labeler_instance</span></div>


    <span class="k">def</span> <span class="nf">_get_saved_time_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Similar to _get_logging_idx(), but for data-table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">activity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">time_window_activity</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">activity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">shortcut_keys</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">activity</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">values</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_handle_first_time_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handling the first shortcut-pressed key for time_window activities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_row_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">time_window_activity</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_row_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">current_row_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">current_row_count</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">logging_activity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">current_row_count</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">,</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="s2">&quot;darkorange&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">write_logger</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handle_second_time_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">activity</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">act_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handling the second time shortcut-pressed key for time_window activities. It is important to know,</span>
<span class="sd">        that &quot;WAIT...&quot; means, it is waiting for the second time to be pressed. So a time_window should be always</span>
<span class="sd">        closed and got StartTime and EndTime.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">activity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">activity</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                        <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">time_window_activity</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">act_idx</span><span class="p">)</span>

        <span class="n">logg_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">get_logging_idx</span><span class="p">(</span><span class="n">activity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shortcut_keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">logg_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">logging_activity</span><span class="p">[</span><span class="n">logg_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">activity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shortcut_keys</span><span class="p">,</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">logging_activity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">activity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shortcut_keys</span><span class="p">,</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">write_logger</span><span class="p">()</span>

<div class="viewcode-block" id="ActivityHandler.populate_data_table_time_window">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.ActivityHandler.populate_data_table_time_window">[docs]</a>
    <span class="k">def</span> <span class="nf">populate_data_table_time_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        As described in _handle_shortcuts() above, this function will handle time_window option. (writing twice)</span>
<span class="sd">        It checks if it is first time pressed or second time pressed for the time_window activity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table_changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">act</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_saved_time_window</span><span class="p">(</span><span class="n">shortcut_keys</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">act</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;WAIT...&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_first_time_window</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">activity</span> <span class="o">=</span> <span class="n">act</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">act_idx</span> <span class="o">=</span> <span class="n">act</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">act</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_second_time_window</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">,</span> <span class="n">activity</span><span class="p">,</span> <span class="n">act_idx</span><span class="p">)</span></div>


<div class="viewcode-block" id="ActivityHandler.populate_data_table_point_activity">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.ActivityHandler.populate_data_table_point_activity">[docs]</a>
    <span class="k">def</span> <span class="nf">populate_data_table_point_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handling point activity (writing once)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table_changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">current_row_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">current_row_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">current_row_count</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">logging_activity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="n">current_row_count</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">,</span> <span class="s2">&quot;#222222&quot;</span><span class="p">,</span> <span class="s2">&quot;#222222&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">write_logger</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="Layout">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout">[docs]</a>
<span class="k">class</span> <span class="nc">Layout</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is for creating the app-layout of the widgets. No functionality, only widgets. If it&#39;s needed to</span>
<span class="sd">    insert more widgets, should be done here. And can be accessed within Labeler class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Layout.__init__">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labeler_instance</span><span class="p">:</span> <span class="n">Labeler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span> <span class="o">=</span> <span class="n">labeler_instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playtime</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">now_playing</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;No Video Playing&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_app_window</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mpv_player</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_table</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_table_scroll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_video_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_table_scroll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_time_slider</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_widget</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger_scroll</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_logger</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_widget</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_second_column_video_layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_splitter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_style</span><span class="p">()</span></div>


<div class="viewcode-block" id="Layout.create_app_window">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.create_app_window">[docs]</a>
    <span class="k">def</span> <span class="nf">create_app_window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QWidget</span><span class="p">,</span> <span class="n">QGridLayout</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will open the main-window and center it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_window</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="n">app_window</span><span class="p">)</span>
        <span class="n">app_window_layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">app_window</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">app_window</span><span class="p">,</span> <span class="n">app_window_layout</span></div>


<div class="viewcode-block" id="Layout.create_mpv_player">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.create_mpv_player">[docs]</a>
    <span class="k">def</span> <span class="nf">create_mpv_player</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QWidget</span><span class="p">,</span> <span class="n">mpv</span><span class="o">.</span><span class="n">MPV</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starting MPV-Player and putting in withing a Widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">video</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">)</span>
        <span class="n">player</span> <span class="o">=</span> <span class="n">mpv</span><span class="o">.</span><span class="n">MPV</span><span class="p">(</span>
            <span class="n">wid</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">winId</span><span class="p">())),</span>
            <span class="n">vo</span><span class="o">=</span><span class="s2">&quot;x11&quot;</span><span class="p">,</span>
            <span class="n">input_default_bindings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">input_vo_keyboard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">osc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="c1"># script_opts=&quot;osd-level=3&quot;</span>
        <span class="p">)</span>
        <span class="n">player</span><span class="p">[</span><span class="s2">&quot;vo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gpu&quot;</span>
        <span class="k">return</span> <span class="n">video</span><span class="p">,</span> <span class="n">player</span></div>


<div class="viewcode-block" id="Layout.create_video_table">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.create_video_table">[docs]</a>
    <span class="k">def</span> <span class="nf">create_video_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QTableWidget</span><span class="p">,</span> <span class="n">QScrollArea</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creating a table for all videos within the folder &quot;videos&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">video_table</span> <span class="o">=</span> <span class="n">QTableWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">)</span>
        <span class="n">video_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">video_table</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">video_table</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s2">&quot;Video&quot;</span><span class="p">])</span>
        <span class="n">video_table</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>

        <span class="n">video_table_scroll</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">)</span>
        <span class="n">video_table_scroll</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">video_table_scroll</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">video_table</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">video_table</span><span class="p">,</span> <span class="n">video_table_scroll</span></div>


<div class="viewcode-block" id="Layout.create_data_table">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.create_data_table">[docs]</a>
    <span class="k">def</span> <span class="nf">create_data_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QTableWidget</span><span class="p">,</span> <span class="n">QScrollArea</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Here will be all the values, that are labeled as an overview</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_table</span> <span class="o">=</span> <span class="n">QTableWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">)</span>
        <span class="n">data_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">data_table</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">data_table</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;STime&quot;</span><span class="p">,</span> <span class="s2">&quot;ETime&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="s2">&quot;Vid&quot;</span><span class="p">])</span>
        <span class="n">data_table</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>

        <span class="c1"># Create a scroll are for the table and set table widget as its widget</span>
        <span class="n">data_table_scroll</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>
        <span class="n">data_table_scroll</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">data_table_scroll</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data_table</span><span class="p">,</span> <span class="n">data_table_scroll</span></div>


<div class="viewcode-block" id="Layout.create_second_column_video_layout">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.create_second_column_video_layout">[docs]</a>
    <span class="k">def</span> <span class="nf">create_second_column_video_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QWidget</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combining MPV-Player, Playing-Time, Video-Name and Time-Slider</span>
<span class="sd">        within one column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">video_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">)</span>
        <span class="n">video_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">video_widget</span><span class="p">)</span>
        <span class="n">video_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">video_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playtime</span><span class="p">)</span>
        <span class="n">video_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_playing</span><span class="p">)</span>
        <span class="n">video_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">video_widget</span><span class="p">,</span> <span class="n">video_layout</span></div>


<div class="viewcode-block" id="Layout.create_logger">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.create_logger">[docs]</a>
    <span class="k">def</span> <span class="nf">create_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QWidget</span><span class="p">,</span> <span class="n">QScrollArea</span><span class="p">,</span> <span class="n">QGridLayout</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The logging window, to get some feedback, what is going on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Will show the labels for every frame (ongoing, not done)</span>
        <span class="n">logger_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">)</span>
        <span class="n">logger_scroller</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>
        <span class="n">logger_scroller</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger_grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">logger_widget</span><span class="p">)</span>
        <span class="n">logger_scroller</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">logger_widget</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">logger_widget</span><span class="p">,</span> <span class="n">logger_scroller</span><span class="p">,</span> <span class="n">logger_grid</span></div>


<div class="viewcode-block" id="Layout.create_splitter">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.create_splitter">[docs]</a>
    <span class="k">def</span> <span class="nf">create_splitter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QSplitter</span><span class="p">,</span> <span class="n">QSplitter</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To make it more user-friendly, there are some splitters.</span>
<span class="sd">        So the user can drag the windows to the size he wants to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add scroll_video_table to the first column</span>
        <span class="n">splitter_v</span> <span class="o">=</span> <span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span>
        <span class="n">splitter_v</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_table_scroll</span><span class="p">)</span>
        <span class="n">splitter_v</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger_scroll</span><span class="p">)</span>

        <span class="n">splitter_h</span> <span class="o">=</span> <span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="n">splitter_h</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">splitter_v</span><span class="p">)</span>
        <span class="n">splitter_h</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_widget</span><span class="p">)</span>
        <span class="n">splitter_h</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_table_scroll</span><span class="p">)</span>

        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="n">splitter_h</span><span class="o">.</span><span class="n">setSizes</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">),</span>
                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)),</span>
                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">splitter_v</span><span class="o">.</span><span class="n">setSizes</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">),</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="n">splitter_h</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">splitter_h</span><span class="p">,</span> <span class="n">splitter_v</span></div>


<div class="viewcode-block" id="Layout.create_time_slider">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.create_time_slider">[docs]</a>
    <span class="k">def</span> <span class="nf">create_time_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QSlider</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is like a slider within any video-player.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="n">time_slider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">time_slider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">time_slider</span><span class="o">.</span><span class="n">setTickPosition</span><span class="p">(</span><span class="n">QSlider</span><span class="o">.</span><span class="n">TicksBelow</span><span class="p">)</span>
        <span class="n">time_slider</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">time_slider</span></div>


<div class="viewcode-block" id="Layout.create_style">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Layout.create_style">[docs]</a>
    <span class="k">def</span> <span class="nf">create_style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Styling the app. Making it more visual-friendly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QHeaderView::section { padding: 1px; }&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QHeaderView::section { padding: 1px; }&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_widget</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color : #999999;&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="AppFunctions">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.AppFunctions">[docs]</a>
<span class="k">class</span> <span class="nc">AppFunctions</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class gives some functionality to the app. Every function can also be accessed within settings.py and</span>
<span class="sd">    bind to a shortcut.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AppFunctions.__init__">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.AppFunctions.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labeler_instance</span><span class="p">:</span> <span class="n">Labeler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span> <span class="o">=</span> <span class="n">labeler_instance</span></div>

        <span class="c1"># Now you have access to all self objects from the Labeler instance</span>

<div class="viewcode-block" id="AppFunctions.sort_data_table">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.AppFunctions.sort_data_table">[docs]</a>
    <span class="k">def</span> <span class="nf">sort_data_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will sort the data table by the first column (in this case StartTime)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">sortByColumn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AscendingOrder</span><span class="p">)</span></div>


<div class="viewcode-block" id="AppFunctions.delete_selected_rows">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.AppFunctions.delete_selected_rows">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_selected_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will deleted selected row in the data tale</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">selected_rows</span><span class="p">:</span>
            <span class="n">rows_to_delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected_rows</span><span class="p">:</span>
                <span class="n">rows_to_delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rows_to_delete</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table_changed</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="AppFunctions.write_csv_data">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.AppFunctions.write_csv_data">[docs]</a>
    <span class="k">def</span> <span class="nf">write_csv_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will write the data to csv. Loading the values from data_table and saving the video_name.csv.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">video_name_csv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_name_playing</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">video_name_csv</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">video_name_csv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">video_name_csv</span> <span class="o">=</span> <span class="n">video_name_csv</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table_changed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data</span><span class="se">\\</span><span class="si">{</span><span class="n">video_name_csv</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
                <span class="n">csvwriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
                <span class="n">csvwriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;STIME&quot;</span><span class="p">,</span> <span class="s2">&quot;ETIME&quot;</span><span class="p">,</span> <span class="s2">&quot;TYPE&quot;</span><span class="p">,</span> <span class="s2">&quot;LABEL&quot;</span><span class="p">,</span> <span class="s2">&quot;VID&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_csv_write_rows</span><span class="p">(</span><span class="n">csvwriter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">logging_activity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Saved&quot;</span><span class="p">,</span> <span class="n">video_name_csv</span><span class="p">,</span> <span class="s2">&quot;#0e1a40&quot;</span><span class="p">,</span> <span class="s2">&quot;#0e1a40&quot;</span><span class="p">,</span> <span class="s2">&quot;Format: CSV&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">write_logger</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table_changed</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="AppFunctions.save_csv">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.AppFunctions.save_csv">[docs]</a>
    <span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is needed to hard-save the csv file. It saves the csv file even the table is not changed. Where write_csv_data()</span>
<span class="sd">        checks if the data_table was changed or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table_changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_csv_data</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_csv_write_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csvwriter</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to write the rows to the csv file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">data_table_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">row_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
                <span class="n">row_column_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">data_table_row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">row_column_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_column_item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">csvwriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

<div class="viewcode-block" id="AppFunctions.load_csv_data">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.AppFunctions.load_csv_data">[docs]</a>
    <span class="k">def</span> <span class="nf">load_csv_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If there are any safed files for the loaded video. It will open the csv file and convert it into the</span>
<span class="sd">        data_table. So you can switch between videos and still have the actual data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="n">video_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">video_name_csv</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">video_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">video_name_csv</span> <span class="o">=</span> <span class="n">video_name_csv</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data</span><span class="se">\\</span><span class="si">{</span><span class="n">video_name_csv</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
                <span class="n">csvreader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">csvreader</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_csv_load_rows</span><span class="p">(</span><span class="n">csvreader</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">logging_activity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Loaded&quot;</span><span class="p">,</span> <span class="n">video_name_csv</span><span class="p">,</span> <span class="s2">&quot;#0e1a40&quot;</span><span class="p">,</span> <span class="s2">&quot;#0e1a40&quot;</span><span class="p">,</span> <span class="s2">&quot;Format: CSV&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">write_logger</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Clear existing rows</span></div>


    <span class="k">def</span> <span class="nf">_csv_load_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csvreader</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to load the rows from the csv file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Clear existing rows</span>
        <span class="k">for</span> <span class="n">row_data</span> <span class="ow">in</span> <span class="n">csvreader</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row_data</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

<div class="viewcode-block" id="AppFunctions.update_video_table">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.AppFunctions.update_video_table">[docs]</a>
    <span class="k">def</span> <span class="nf">update_video_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will create the playlist as a table, so all the videos in the &quot;videos&quot; directory will be shown as a table.</span>
<span class="sd">        Disable edits for column 0 (Video).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">videos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;videos&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">video</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">videos</span><span class="p">):</span>
            <span class="n">current_row_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">current_row_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">current_row_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">video</span><span class="p">))</span></div>


<div class="viewcode-block" id="AppFunctions.plot_hotkeys">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.AppFunctions.plot_hotkeys">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_hotkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To get access to plot hotkeys within settings.json. Important to know here. It will also open the plotted</span>
<span class="sd">        hotkeys and write it into the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">HotkeyPlotter</span><span class="p">()</span><span class="o">.</span><span class="n">load_and_plot</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="s2">&quot;Hotkeys.png&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">logging_activity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Saved&quot;</span><span class="p">,</span>
                                                     <span class="s2">&quot;Hotkeys.png&quot;</span><span class="p">,</span>
                                                     <span class="s2">&quot;#0e1a40&quot;</span><span class="p">,</span>
                                                     <span class="s2">&quot;#0e1a40&quot;</span><span class="p">,</span>
                                                     <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">IF CHANGE .json -&gt; RESTART APP&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">write_logger</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="MouseEventHandler">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.MouseEventHandler">[docs]</a>
<span class="k">class</span> <span class="nc">MouseEventHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper class for handling all the events of Labeler class.</span>
<span class="sd">    Everything that happens with Mouse-Clicks is an Event in this case.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MouseEventHandler.__init__">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.MouseEventHandler.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labeler_instance</span><span class="p">:</span> <span class="n">Labeler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span> <span class="o">=</span> <span class="n">labeler_instance</span></div>

        <span class="c1"># Now you have access to all self objects from the Labeler instance</span>

<div class="viewcode-block" id="MouseEventHandler.close_app">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.MouseEventHandler.close_app">[docs]</a>
    <span class="k">def</span> <span class="nf">close_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">QCloseEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom close event. If data-table was changed it will ask the user, if he wants to save the actual</span>
<span class="sd">        data-table. Save, Discard or Cancel possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table_changed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">,</span> <span class="s1">&#39;Message&#39;</span><span class="p">,</span>
                                         <span class="s2">&quot;Do you want to save changes?&quot;</span><span class="p">,</span>
                                         <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Save</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Discard</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">,</span>
                                         <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Save</span><span class="p">:</span>
                <span class="n">video_name_csv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_name_playing</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">video_name_csv</span> <span class="o">!=</span> <span class="s2">&quot;No Video Playing&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">app_functions</span><span class="o">.</span><span class="n">save_csv</span><span class="p">()</span>
                <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>  <span class="c1"># Close the window</span>
            <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Discard</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>  <span class="c1"># Close the window</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>  <span class="c1"># Keep the window open</span></div>


<div class="viewcode-block" id="MouseEventHandler.video_table_click">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.MouseEventHandler.video_table_click">[docs]</a>
    <span class="k">def</span> <span class="nf">video_table_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">QTableWidgetItem</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starting and playing a video, by clicking on the row of the video in the table (play_list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">video_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="n">video_name_csv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_name_playing</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">video_name_csv</span> <span class="o">!=</span> <span class="s2">&quot;No Video Playing&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">app_functions</span><span class="o">.</span><span class="n">write_csv_data</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">keep_open</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;videos/</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">observe_time_position</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_name_playing</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">video_name</span><span class="p">)</span>

        <span class="c1"># self.labeler.close_event()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">app_functions</span><span class="o">.</span><span class="n">load_csv_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table_changed</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="MouseEventHandler.data_table_click">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.MouseEventHandler.data_table_click">[docs]</a>
    <span class="k">def</span> <span class="nf">data_table_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">QTableWidgetItem</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handling a row click on the populated data table. If row StartTime is selected, it will go to the</span>
<span class="sd">        video with the StartTime. If EndTime, it will go there. If something else. It will go to StartTime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">column</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">video_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">keep_open</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;videos/</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">wait_for_property</span><span class="p">(</span><span class="s1">&#39;seekable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="s2">&quot;absolute&quot;</span><span class="p">,</span> <span class="s2">&quot;exact&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">observe_time_position</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_name_playing</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">video_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="MouseEventHandler.slider_move">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.MouseEventHandler.slider_move">[docs]</a>
    <span class="k">def</span> <span class="nf">slider_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handling the slider mouse press event. So it acts like a normal slider for a video.</span>
<span class="sd">        For example, you can add self.player.pause = False at the end, and it will play the video</span>
<span class="sd">        after releasing the mouse. So some settings for the slider can be done here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">click_pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">QStyle</span><span class="o">.</span><span class="n">sliderValueFromPosition</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">minimum</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">maximum</span><span class="p">(),</span>
            <span class="n">click_pos</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># noinspection PyUnresolvedReferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">seek_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">duration</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">seek_time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">append_logging</span><span class="p">(</span>
                <span class="n">logg_type</span><span class="o">=</span><span class="s2">&quot;Information&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ERROR probably corrupted VIDEO: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">bg_color</span><span class="o">=</span><span class="s2">&quot;#400000&quot;</span><span class="p">,</span>
                <span class="n">border_color</span><span class="o">=</span><span class="s2">&quot;#400000&quot;</span><span class="p">,</span>
                <span class="n">ignore_if_tracked</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;seek&#39;</span><span class="p">,</span> <span class="n">seek_time</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MouseEventHandler.splitter_click">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.MouseEventHandler.splitter_click">[docs]</a>
    <span class="k">def</span> <span class="nf">splitter_click</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the sizes of widgets based on the size of the first element in the splitter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">video_table_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">splitter_h</span><span class="o">.</span><span class="n">sizes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
        <span class="n">data_table_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">splitter_h</span><span class="o">.</span><span class="n">sizes</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.95</span><span class="p">)</span>
        <span class="n">columns_videos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span>
        <span class="n">columns_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span>
        <span class="n">video_table_size</span> <span class="o">=</span> <span class="n">video_table_size</span> <span class="o">//</span> <span class="n">columns_videos</span>
        <span class="n">data_table_size</span> <span class="o">=</span> <span class="n">data_table_size</span> <span class="o">//</span> <span class="n">columns_data</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">columns_videos</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">video_table</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">video_table_size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">columns_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">data_table_size</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Logger">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Logger">[docs]</a>
<span class="k">class</span> <span class="nc">Logger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is creating some logging to inform the user what happens. The most important cases are</span>
<span class="sd">    handled here and will be written into the Logging window within the app.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Logger.__init__">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Logger.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labeler_instance</span><span class="p">:</span> <span class="n">Labeler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span> <span class="o">=</span> <span class="n">labeler_instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_max</span> <span class="o">=</span> <span class="mi">12</span>  <span class="c1"># Max number of logging rows</span></div>


<div class="viewcode-block" id="Logger.get_logging_idx">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Logger.get_logging_idx">[docs]</a>
    <span class="k">def</span> <span class="nf">get_logging_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">shortcut_keys</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Needed for time_window activities. So if the shortcut was already pressed it will return the index of</span>
<span class="sd">        the list, else it returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">activity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">activity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">shortcut_keys</span> <span class="ow">and</span> <span class="n">activity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">act_idx</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">idx</span>
        <span class="k">return</span> <span class="kc">None</span></div>


    <span class="k">def</span> <span class="nf">_remove_too_many_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removing too long logging list. Can be setup within settings.json as &quot;log_max&quot;. Important to keep an</span>
<span class="sd">        overview about labeling.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_max</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">logg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">logg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;darkorange&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_clear_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removing log-widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger_grid</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="n">widget_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger_grid</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">widget_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger_grid</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="n">widget_item</span><span class="o">.</span><span class="n">widget</span><span class="p">())</span>

<div class="viewcode-block" id="Logger.append_logging">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Logger.append_logging">[docs]</a>
    <span class="k">def</span> <span class="nf">append_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">logg_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Information&quot;</span><span class="p">,</span>
                       <span class="c1"># &quot;Information&quot;, &quot;Saved&quot;, &quot;Loaded&quot; possible else is index of data_table</span>
                       <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                       <span class="n">bg_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span>
                       <span class="n">border_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span>
                       <span class="n">text_2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                       <span class="n">ignore_if_tracked</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
                       <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Easier way to append the logging activity. More understandable.</span>
<span class="sd">        Set ignore_if_tracked as True if you want to show it only once or if it already in the logging window.</span>
<span class="sd">        Then it won&#39;t display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ignore_if_tracked</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">[</span><span class="n">logg_type</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">,</span> <span class="n">border_color</span><span class="p">,</span> <span class="n">text_2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">logg_type</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">,</span> <span class="n">border_color</span><span class="p">,</span> <span class="n">text_2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">logg_type</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">,</span> <span class="n">border_color</span><span class="p">,</span> <span class="n">text_2</span><span class="p">])</span></div>


<div class="viewcode-block" id="Logger.write_logger">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.Logger.write_logger">[docs]</a>
    <span class="k">def</span> <span class="nf">write_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create Labels as a logging window within the GUI. Use &quot;Information&quot; as the first value within</span>
<span class="sd">        the logging_activity list. Just append this list somewhere with three values. or just use</span>
<span class="sd">        append_logging() instead of self.logging_activity.append(). Both ways are fine.</span>

<span class="sd">        Example:</span>
<span class="sd">        --------</span>
<span class="sd">        self.logging_activity.append([&quot;Information&quot;,</span>
<span class="sd">        &quot;The data is saved to .csv&quot;,</span>
<span class="sd">        &quot;Check documentation for more Information&quot;])</span>
<span class="sd">        self.logger.write_logger() # Will write the appended logging</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Clearing the layout before reading widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_logger</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">activity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span><span class="p">):</span>
            <span class="n">act_row</span> <span class="o">=</span> <span class="n">activity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">act_key</span> <span class="o">=</span> <span class="n">activity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">act_bg_color</span> <span class="o">=</span> <span class="n">activity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">act_border_color</span> <span class="o">=</span> <span class="n">activity</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">act_data</span> <span class="o">=</span> <span class="n">activity</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">act_row</span> <span class="o">==</span> <span class="s2">&quot;Saved&quot;</span> <span class="ow">or</span> <span class="n">act_row</span> <span class="o">==</span> <span class="s2">&quot;Loaded&quot;</span> <span class="ow">or</span> <span class="n">act_row</span> <span class="o">==</span> <span class="s2">&quot;Information&quot;</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="n">act_row</span><span class="p">,</span> <span class="n">act_key</span><span class="p">,</span> <span class="n">act_data</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">act_row</span><span class="p">),</span> <span class="n">act_key</span><span class="p">,</span> <span class="n">act_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">act_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">act_data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">act_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logging_activity</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;background-color: #111111; border: 1px solid darkgreen;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;background-color: </span><span class="si">{</span><span class="n">act_bg_color</span><span class="si">}</span><span class="s2">; border: 1px solid </span><span class="si">{</span><span class="n">act_border_color</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">logger_grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_too_many_logs</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="HotkeyPlotter">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.HotkeyPlotter">[docs]</a>
<span class="k">class</span> <span class="nc">HotkeyPlotter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is for checking the hotkeys and creating a plot for all the available hotkeys to give an</span>
<span class="sd">    overview to the user. The user can instantly see all the available hotkeys and also to check if there</span>
<span class="sd">    are some duplicated hotkeys, which should be avoided.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HotkeyPlotter.__init__">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.HotkeyPlotter.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># noinspection PyUnresolvedReferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">colors</span></div>


    <span class="k">def</span> <span class="nf">_check_for_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ordered_pairs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finding duplicates within a dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ordered_pairs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Duplicated key&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">_make_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Making the plot more visible for the user with colors. Duplicated values are marked as red for example.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Duplicates&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Duplicated key&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;File&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;settings.json&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;File&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;label_shortcuts.json&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;File&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;commands_mpv.json&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_load_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loading all the json files and adding them to a DataFrame. Also checking the duplicates.</span>
<span class="sd">        Is needed for plotting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_for_duplicates</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">json_file</span> <span class="o">==</span> <span class="s2">&quot;label_shortcuts.json&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">act_type</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">[</span><span class="n">act_type</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">act_type</span><span class="p">,</span> <span class="n">json_file</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">json_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">json_file</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Hotkey&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ActType&quot;</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_plot_hotkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creating the plot of hotkeys named as Hotkeys.png within the application folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_colors</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Duplicates&quot;</span><span class="p">])</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">table</span><span class="p">(</span>
            <span class="n">cellText</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">colLabels</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">cellLoc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
            <span class="n">cellColours</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">get_celld</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">table</span><span class="o">.</span><span class="n">get_celld</span><span class="p">()[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Hotkeys.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="HotkeyPlotter.load_and_plot">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.HotkeyPlotter.load_and_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">load_and_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The whole process from loading until plotting the hotkeys.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_files</span><span class="p">(</span><span class="s2">&quot;label_shortcuts.json&quot;</span><span class="p">)</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_files</span><span class="p">(</span><span class="s2">&quot;settings.json&quot;</span><span class="p">)</span>
        <span class="n">label_shortcuts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_files</span><span class="p">(</span><span class="s2">&quot;commands_mpv.json&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">label_shortcuts</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;Hotkey&quot;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Duplicates&quot;</span><span class="p">],</span> <span class="s2">&quot;Duplicated key&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_hotkeys</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="start_app">
<a class="viewcode-back" href="../video_labeler.html#video_labeler.start_app">[docs]</a>
<span class="k">def</span> <span class="nf">start_app</span><span class="p">():</span>
    <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_NUMERIC</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">Labeler</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">start_app</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright -.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>